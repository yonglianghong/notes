### 用户画像分析

##### 1.整体流程

![](https://hong-md.oss-cn-beijing.aliyuncs.com/md/2018-12-31-UserPortrait.png)

#####2.数据准备

a) 全量用户编码表，用于存储uid与id值的映射关系

b) 用户标签表 -> 用户标签bitmap表

c) 用户流量表，用户级别的流量统计

##### 3.计算

a) 传入标签组合

1. 按标签组合生成人群bitmap
2. 将人群bitmap与各标签对应bitmap做交集，返回uv及占比
3. 将人群bitmap转化成uid集合
4. 将上一步得到的uid集合与用户流量表关联得到流量分布指标

b) 传入hdfs路径

1. 将人群转化成bitmap
2. 同a)流程

#####4.优化

a) 将人群bitmap及画像指标结果存储起来，类似的查询条件，可以复用

b) 人群构建与人群画像分离，画像采用抽样bitmap？

c) 全量用户编码表采用AppendTrieDictionary实现？