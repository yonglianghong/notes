#### 用户画像

##### 什么是用户画像？

画像，顾名思义，就是一个人的描绘，通过画像，我们能在大脑里构建起大概的轮廓。而描绘人的维度可以事实的，也可以是抽象的。通常我们会用这样一些维度去描述一个人：

- 自然属性：性别、年龄

- 社会属性：职业、社交
- 财富状况：是否高收入人群，是否有固定资产
- 家庭情况：是否已经结婚，是否有孩子
- 购物习惯：是喜欢网购还是喜欢逛商城
- 位置特征：比如在哪个城市哪个区域生活
- 行为特征：比如喜欢浏览什么内容

总而言之，**画像就是想方设法用数据来描述人的特征**。

##### 为什么需要用户画像？

之所以要进行用户画像，就是为了解决业务问题，或为了拓展一个新用户，或为了获得一个新订单。一方面，如果清晰知道自己产品定位的用户画像，能够避免产品设计的时候定位不清晰，导致产品上线后达不到预期效果。另一方面，通过对自己产品的用户群体进行画像，也能更深入地了解用户，或许会有意想不到的收获。

##### 如何利用用户画像？

定义业务问题，用户画像在明确业务目标、实现业务目标都可以发挥作用。总体来看，**用户画像承载了两个业务目标：一是如何准确的了解现有用户；二是如何在茫茫人海中通过广告营销获取类似画像特征的新用户**。

了解现有用户的画像，需要的是少量、画像特征覆盖度全面的无倾斜的精准样本，这样能更精确的定位产品的用户。而通过画像结果做广告营销获取新用户，在一定程度上需要的是大量的相似样本。

##### 标签？

标签是表达人的基本属性、行为倾向、兴趣偏好等某一个维度的数据标识，它是一种相关性很强的关键字，可以简洁的描述和分类人群。标签的定义来源于业务目标，基于不同的行业，不同的应用场景，同样的标签名称可能代表了不同的含义，也决定了不同的模型设计和数据处理方式。

举个例子，如果一款卖男装的 app 想在近期做营销，只筛选“男性”和“网络购物”这两个标签进行投放，可能效果并不一定理想。因为“性别（男 / 女）”可能有多种维度，真实性别男女是一种维度，网络购物特征男女是一种维度，性取向男女可能又是另外一种维度。因为网络的发展，你甚至都不知道网络的另一端是不是一个人，更何况是男女呢。想要正确的设计标签模型和计算处理数据，必须了解画像标签应用的场景和目标。

##### 如何进行用户画像？

这完全取决于业务目标(需要什么样的标签)和由什么样的原材料(有什么样类型的数据源)，基于这两样才能基本确定使用什么样的模型设计和数据计算处理方式。就像做菜一样，要做一顿美味的晚餐，必须知道客户是想吃中餐还是西餐，配菜都有哪些鱼蛋肉和蔬菜，然后才能确定牛肉是红烧还是煎炸。

##### 建立标签体系

- 人口属性：包含性别、年龄等人的基本特征
- 资产情况：车辆、房产、收入等资产特征
- 兴趣特征：阅读资讯、运动健康等兴趣偏好
- 消费特征：网上 / 线下消费类别品牌等特征
- 位置特征：常驻城市、职住距离等
- 设备属性：所使用终端的特性等

要支持以上这些标签的设计和计算，需要多种维度的数据源，从产生维度来看：可以包含 PC 端的数据、移动终端的数据、线下的数据；从数据拥有者来看：可以包含一方客户自己的数据、外部官方渠道的数据、市场采集的数据；从数据类型来看：有社交数据、交易数据、位置数据、运营商数据等。

使用这些不同源的数据，我们如何计算处理业务需要的标签呢？一般都会经过如下几步：

1. 数据抽取：从不同数据源抽取要计算标签的数据原材料。
2. 数据标准化：针对抽取的数据将其清洗为标准格式，将其中的错误数据和无效数据剔除。
3. 数据打通：不同来源的数据有不同的主键和属性，如何将这些数据关联起来是数据打通的关键，比如有设备的 wifi 信息，又有设备的 poi 信息，就可以通过 wifi 将设备终端和 POI 建立起关联。
4. 模型设计：针对不同的数据内容和业务目标设计不同的规则和算法进行模型的构建，并使用小样本数据来验证模型的可靠性。
5. 标签计算：在模型可靠性验证的基础上，部署生产运营环境来进行标签计算。

##### 用户画像和标签设计/计算中的一些难点

1. 如何定义画像主题？即如何唯一标识一个实体？

   用户唯一ID体系

2. 如何打通不同源的数据？

   id mappinp

3. 标签如何验证？

   a) 小样本真实验证

   b) 在实际的case中迭代验证

   c) 外部标签交叉验证："已婚"标签不应该有"18岁已下"的人，"已婚"标签的"大学生"应该极少，"大学生"标签人群应该"有车"也很少。

4. 大数据本身不存在所谓的正确性，大数据是用来验证人的先验知识/经验的一种工具，这个里边应该考虑的不止是准确性的问题，而是如何能更好的提高你认为的准确率的问题，大数据由于体量大，需要的是数量、时间等多维的迭代，维度的扩展。

参考：[40 亿移动设备的用户画像和标签架构实践](https://www.infoq.cn/article/4-billion-mobile-device-user-portrait-and-tag-architecture)

##### 用户画像计算

画像指标：

1. 近7日活跃uv覆盖度
2. 在其他标签类型的分布(比如年龄、性别、兴趣等的分布)，uv占比以及tgi
3. 广告曝光、点击

近7日活跃uv，可以生成一个标签，这样与crowd做一个交集，就可以得到近7日uv覆盖度。

所以，整体计算分两种：

1. 标签计算：
2. join计算？

##### 标签计算：

1. 因为tgi涉及到crowd中这类标签总的uv和总体中这类标签总的uv，所以可以将crowd与tag_type做交集，再广播
2. 在executor端，crowd与各个tag做交集
3. 计算tgi与uv占比，返回给driver端

##### 标签存储：

1. crowd分为两种，一种是事先生成的，一种是实时生成的，对于事先生成的，可以单独存储在hive表里；
2. tag与tag_type可以存储在一张表里面，所有标签数据按hash平均分配；

参考：[聊一聊用户画像如何存储](http://stor.51cto.com/art/201805/573491.htm)























