### 用户标签计算

##### 初始

1. 用户实体u定义：能唯一标识一个用的值，比如idfa/imei

2. 标签体系本身有层级，在进行标签计算时，按理可以给用户打上最细粒度标签就可以



##### 标签计算类型

1. init：标签计算初始化，第一次开始计算标签
2. daily：按某个周期（天）计算
3. merge：不同类型的标签合并



##### 标签计算步骤

1. 用户日志数据处理，处理成可以根据标签计算规则直接映射成标签的格式

2. 标签计算

   2.1 解析标签计算规则

   2.2 将日志按计算规则映射成标签，并赋予初始权重

   2.3 按u聚合标签

   2.4 补充u信息

   2.5 补充层级标签

   2.6 生成active_tags

3. 历史标签合并

   3.1 读取用户历史标签history_tags

   3.2 将当前标签与历史标签full join，生成<u, active_tags, history_tags>

   3.3 合并同一个用户的active_tags和history_tags，更新权重

4. 标签数据存储

5. 标签指标统计

   5.1 标签日活覆盖度

   5.2 标签质量评分

   5.3 标签使用效果评分



##### 标签计算规则

1. log<field1, field2, field3, field4, … , filedn>，可以直接基于<fieldx, fieldy, fieldz> => tag
2. log<field1, field2, field3, field4, … , filedn>，可以基于fieldx => item=> tag